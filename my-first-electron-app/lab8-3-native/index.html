<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Wallboard - Lab 8.3</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 20px;
    }
    
    .header h1 {
      margin: 0;
      font-size: 2.5em;
      background: linear-gradient(45deg, #4CAF50, #2196F3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .section {
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .section h3 {
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.4em;
    }
    
    .button {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .button-secondary {
      background: linear-gradient(135deg, #2196F3, #1976D2);
    }
    
    .button-warning {
      background: linear-gradient(135deg, #ff9800, #f57c00);
    }
    
    .button-danger {
      background: linear-gradient(135deg, #f44336, #d32f2f);
    }
    
    .result-box {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
      border-left: 4px solid #4CAF50;
    }
    
    .file-content {
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
    }
    
    textarea {
      width: 100%;
      height: 150px;
      padding: 15px;
      border: none;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      resize: vertical;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
    }
    
    .loading { color: #FFD700; border-left-color: #FFD700; }
    .success { color: #90EE90; border-left-color: #4CAF50; }
    .error { color: #FF6B6B; border-left-color: #f44336; }
    
    /* Dashboard Styles */
    .dashboard-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .update-time {
      font-size: 12px;
      color: #ccc;
      margin-left: auto;
      background: rgba(0, 0, 0, 0.3);
      padding: 5px 10px;
      border-radius: 15px;
    }
    
    .agents-list {
      display: grid;
      gap: 12px;
      margin-bottom: 25px;
    }
    
    .agent-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .agent-card:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .agent-info {
      flex: 1;
    }
    
    .agent-name {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .agent-details {
      font-size: 13px;
      color: #ccc;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .agent-status {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .status-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      min-width: 80px;
    }
    
    .status-available { 
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
    }
    .status-busy { 
      background: linear-gradient(135deg, #f44336, #d32f2f);
      color: white;
    }
    .status-break { 
      background: linear-gradient(135deg, #ff9800, #f57c00);
      color: white;
    }
    .status-offline { 
      background: linear-gradient(135deg, #757575, #616161);
      color: white;
    }
    
    .status-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    
    .status-btn.active {
      box-shadow: 0 0 0 2px white;
    }
    
    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 25px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      transition: transform 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .stat-card h4 {
      margin: 0 0 12px 0;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .stat-card span {
      font-size: 2em;
      font-weight: bold;
      display: block;
    }
    
    /* Chart container */
    .chart-container {
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 10px;
      margin-top: 20px;
      min-height: 300px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Settings Panel */
    .settings-panel {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 10px;
      margin-top: 15px;
    }
    
    .setting-item {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }
    
    .setting-label {
      flex: 1;
      font-weight: 600;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #4CAF50;
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    /* Keyboard Shortcuts Help */
    .shortcuts-help {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .shortcut-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      font-size: 13px;
    }
    
    .shortcut-key {
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .agent-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .agent-status {
        width: 100%;
        justify-content: center;
      }
      
      .dashboard-controls {
        justify-content: center;
      }
      
      .update-time {
        margin-left: 0;
        margin-top: 10px;
      }
    }

    /* Animation */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    .new-call {
      animation: pulse 1s 3;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìä Agent Wallboard Dashboard</h1>
      <p>Real-time Agent Monitoring & Management System</p>
      <div class="update-time" id="lastUpdate">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: -</div>
    </div>

    <!-- Agent Status Dashboard -->
    <div class="section">
      <h3>üë• Agent Status Dashboard</h3>
      <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Agents ‡πÅ‡∏ö‡∏ö Real-time</p>
      
      <div class="dashboard-controls">
        <button class="button" onclick="addNewAgent()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° Agent</button>
        <button class="button button-secondary" onclick="exportAgentReport()">üìà Export Report</button>
        <button class="button button-secondary" onclick="refreshDashboard()">üîÑ Refresh</button>
        <button class="button button-warning" onclick="simulateIncomingCall()">üìû ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤</button>
        <button class="button" onclick="toggleAutoRefresh()" id="autoRefreshBtn">‚è∞ ‡πÄ‡∏õ‡∏¥‡∏î Auto-Refresh</button>
      </div>
      
      <div class="stats-summary">
        <div class="stat-card">
          <h4>üü¢ Available</h4>
          <span id="availableCount">0</span>
        </div>
        <div class="stat-card">
          <h4>üî¥ Busy</h4>
          <span id="busyCount">0</span>
        </div>
        <div class="stat-card">
          <h4>üü° Break</h4>
          <span id="breakCount">0</span>
        </div>
        <div class="stat-card">
          <h4>üìû Total Calls</h4>
          <span id="totalCalls">0</span>
        </div>
        <div class="stat-card">
          <h4>üë• Total Agents</h4>
          <span id="totalAgents">0</span>
        </div>
      </div>
      
      <div id="agentsList" class="agents-list">
        <!-- Agents ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      </div>
    </div>

    <!-- Performance Charts -->
    <div class="section">
      <h3>üìà Performance Analytics</h3>
      <p>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Agents</p>
      
      <div class="chart-container">
        <canvas id="performanceChart" width="400" height="200"></canvas>
      </div>
    </div>

    <!-- File Operations -->
    <div class="section">
      <h3>üìÅ File Operations</h3>
      <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢ Native OS Dialogs</p>
      
      <button class="button" onclick="openFile()">üìÇ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå</button>
      <button class="button button-secondary" onclick="exportAgentData()">üìä Export Agent Data</button>
      <button class="button button-secondary" onclick="saveCurrentContent()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</button>
      <button class="button" onclick="backupSettings()">üíæ Backup Settings</button>
      
      <div class="result-box" id="fileResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö file operations</div>
      
      <div id="fileContent" class="file-content" style="display: none;"></div>
    </div>

    <!-- Desktop Notifications -->
    <div class="section">
      <h3>üîî Smart Notifications</h3>
      <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
      
      <button class="button" onclick="testBasicNotification()">üîî ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Notification</button>
      <button class="button button-secondary" onclick="testAgentLogin()">üü¢ Agent Login</button>
      <button class="button button-secondary" onclick="testCallReceived()">üìû Call Received</button>
      <button class="button button-warning" onclick="testUrgentAlert()">üö® Urgent Alert</button>
      <button class="button button-danger" onclick="testSoundNotification()">üîä Test Sound</button>
      
      <div class="result-box" id="notificationResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö notifications</div>
    </div>

    <!-- System Tray Integration -->
    <div class="section">
      <h3>üñ±Ô∏è System Tray Integration</h3>
      <p>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏≠‡∏õ‡∏ú‡πà‡∏≤‡∏ô System Tray</p>
      
      <button class="button" onclick="testHideToTray()">üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ Tray</button>
      <button class="button button-secondary" onclick="testTrayNotification()">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å Tray</button>
      <button class="button" onclick="showShortcutsHelp()">‚å®Ô∏è ‡πÅ‡∏™‡∏î‡∏á Keyboard Shortcuts</button>
      
      <div class="result-box" id="trayResult">
üéØ System Tray Features:
‚Ä¢ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô taskbar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
‚Ä¢ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Agent ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å tray menu  
‚Ä¢ ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Available Agents ‡πÉ‡∏ô tooltip
‚Ä¢ ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å tray
‚Ä¢ ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å tray menu

üí° ‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ - ‡πÅ‡∏≠‡∏õ‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô system tray!
      </div>

      <!-- Keyboard Shortcuts Help -->
      <div class="shortcuts-help" id="shortcutsHelp" style="display: none;">
        <div class="shortcut-item">
          <span>‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô ‡πÅ‡∏≠‡∏õ</span>
          <span class="shortcut-key">Ctrl+4</span>
        </div>
        <div class="shortcut-item">
          <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Available</span>
          <span class="shortcut-key">Ctrl+1</span>
        </div>
        <div class="shortcut-item">
          <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Busy</span>
          <span class="shortcut-key">Ctrl+2</span>
        </div>
        <div class="shortcut-item">
          <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Break</span>
          <span class="shortcut-key">Ctrl+3</span>
        </div>
        <div class="shortcut-item">
          <span>‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ Tray</span>
          <span class="shortcut-key">Ctrl+5</span>
        </div>
        <div class="shortcut-item">
          <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</span>
          <span class="shortcut-key">Ctrl+Q</span>
        </div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div class="section">
      <h3>‚öôÔ∏è System Settings</h3>
      <p>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</p>
      
      <div class="settings-panel">
        <div class="setting-item">
          <div class="setting-label">üîî Enable Sound Notifications</div>
          <label class="toggle-switch">
            <input type="checkbox" id="soundEnabled" checked onchange="toggleSound(this.checked)">
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="setting-item">
          <div class="setting-label">üîÑ Auto-Refresh Every 30s</div>
          <label class="toggle-switch">
            <input type="checkbox" id="autoRefresh" checked onchange="toggleAutoRefreshSetting(this.checked)">
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="setting-item">
          <div class="setting-label">üìû Simulate Incoming Calls</div>
          <label class="toggle-switch">
            <input type="checkbox" id="simulateCalls" checked onchange="toggleCallSimulation(this.checked)">
            <span class="slider"></span>
          </label>
        </div>
      </div>
      
      <button class="button" onclick="saveSettings()">üíæ Save Settings</button>
      <button class="button button-secondary" onclick="loadSettings()">üì• Load Settings</button>
      <button class="button button-warning" onclick="resetSettings()">üîÑ Reset Settings</button>
    </div>

    <!-- Text Editor -->
    <div class="section">
      <h3>üìù Text Editor</h3>
      <p>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
      
      <textarea id="textEditor" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà... ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ">
# Agent Wallboard Report
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH')}
‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleTimeString('th-TH')}

## ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Agents
- Available: 1 ‡∏Ñ‡∏ô
- Busy: 1 ‡∏Ñ‡∏ô  
- Break: 1 ‡∏Ñ‡∏ô
- Total Calls: 35 calls

## ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
- Average Call Time: 245 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- Average Wait Time: 45 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- Service Level: 85%

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Agent Wallboard System
      </textarea>
    </div>
  </div>

  <script>
    // ===== GLOBAL VARIABLES =====
    let agents = [
      { 
        id: 'AG001', 
        name: 'Alice Johnson', 
        status: 'available', 
        extension: '1001', 
        department: 'Sales', 
        calls: 15, 
        lastCall: '10:30',
        loginTime: '08:00'
      },
      { 
        id: 'AG002', 
        name: 'Bob Smith', 
        status: 'busy', 
        extension: '1002', 
        department: 'Support', 
        calls: 8, 
        lastCall: '10:25',
        loginTime: '08:15'
      },
      { 
        id: 'AG003', 
        name: 'Carol Lee', 
        status: 'break', 
        extension: '1003', 
        department: 'Sales', 
        calls: 12, 
        lastCall: '09:45',
        loginTime: '08:30'
      }
    ];

    let autoRefreshInterval = null;
    let performanceChart = null;
    let settings = {
      soundEnabled: true,
      autoRefresh: true,
      simulateCalls: true
    };

    // ===== DASHBOARD FUNCTIONS =====
    function renderAgents() {
      const agentsList = document.getElementById('agentsList');
      const availableCount = agents.filter(a => a.status === 'available').length;
      const busyCount = agents.filter(a => a.status === 'busy').length;
      const breakCount = agents.filter(a => a.status === 'break').length;
      const totalCalls = agents.reduce((sum, agent) => sum + agent.calls, 0);
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
      document.getElementById('availableCount').textContent = availableCount;
      document.getElementById('busyCount').textContent = busyCount;
      document.getElementById('breakCount').textContent = breakCount;
      document.getElementById('totalCalls').textContent = totalCalls;
      document.getElementById('totalAgents').textContent = agents.length;
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó tray tooltip
      updateTrayTooltip(availableCount);
      
      // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå agents
      agentsList.innerHTML = agents.map(agent => `
        <div class="agent-card" data-agent-id="${agent.id}">
          <div class="agent-info">
            <div class="agent-name">
              <span class="status-indicator" style="color: ${
                agent.status === 'available' ? '#4CAF50' : 
                agent.status === 'busy' ? '#f44336' : '#ff9800'
              }">‚óè</span>
              ${agent.name} 
              <span style="font-size: 0.9em; opacity: 0.8;">(${agent.id})</span>
            </div>
            <div class="agent-details">
              <span>üìû ${agent.extension}</span>
              <span>üè¢ ${agent.department}</span>
              <span>üìä ${agent.calls} calls</span>
              <span>‚è∞ Login: ${agent.loginTime}</span>
              ${agent.lastCall ? `<span>üìû Last: ${agent.lastCall}</span>` : ''}
            </div>
          </div>
          <div class="agent-status">
            <button class="status-btn status-available ${agent.status === 'available' ? 'active' : ''}" 
                    onclick="changeAgentStatus('${agent.id}', 'available')">üü¢ Available</button>
            <button class="status-btn status-busy ${agent.status === 'busy' ? 'active' : ''}" 
                    onclick="changeAgentStatus('${agent.id}', 'busy')">üî¥ Busy</button>
            <button class="status-btn status-break ${agent.status === 'break' ? 'active' : ''}" 
                    onclick="changeAgentStatus('${agent.id}', 'break')">üü° Break</button>
            <button class="status-btn status-offline" 
                    onclick="removeAgent('${agent.id}')">‚ùå Remove</button>
          </div>
        </div>
      `).join('');
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      document.getElementById('lastUpdate').textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString('th-TH')}`;
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó chart
      renderPerformanceChart();
    }

    function changeAgentStatus(agentId, newStatus) {
      const agent = agents.find(a => a.id === agentId);
      if (agent) {
        const oldStatus = agent.status;
        agent.status = newStatus;
        agent.lastCall = new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô calls ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô busy
        if (newStatus === 'busy' && oldStatus !== 'busy') {
          agent.calls++;
        }
        
        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        if (oldStatus !== newStatus) {
          window.nativeAPI.notifyAgentEvent(agent.name, 'status_change', { 
            oldStatus, 
            newStatus,
            agentId: agent.id
          });
          
          // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ
          if (settings.soundEnabled) {
            window.nativeAPI.playNotificationSound('status_change');
          }
        }
        
        renderAgents();
        saveSettings();
      }
    }

    function addNewAgent() {
      const newId = 'AG' + String(agents.length + 1).padStart(3, '0');
      const newAgent = {
        id: newId,
        name: `Agent ${newId}`,
        status: 'available',
        extension: String(1000 + agents.length + 1),
        department: 'General',
        calls: 0,
        lastCall: null,
        loginTime: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
      };
      
      agents.push(newAgent);
      renderAgents();
      saveSettings();
      
      // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
      window.nativeAPI.notifyAgentEvent(newAgent.name, 'login', {});
      
      if (settings.soundEnabled) {
        window.nativeAPI.playNotificationSound('login');
      }
    }

    function removeAgent(agentId) {
      const agent = agents.find(a => a.id === agentId);
      if (agent && confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${agent.name} ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`)) {
        agents = agents.filter(a => a.id !== agentId);
        renderAgents();
        saveSettings();
        
        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        window.nativeAPI.notifyAgentEvent(agent.name, 'logout', {});
      }
    }

    // ===== CHART FUNCTIONS =====
    function renderPerformanceChart() {
      const ctx = document.getElementById('performanceChart').getContext('2d');
      
      if (performanceChart) {
        performanceChart.destroy();
      }
      
      const statusCounts = {
        available: agents.filter(a => a.status === 'available').length,
        busy: agents.filter(a => a.status === 'busy').length,
        break: agents.filter(a => a.status === 'break').length
      };
      
      const callData = agents.map(agent => agent.calls);
      const agentNames = agents.map(agent => agent.name);
      
      performanceChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: agentNames,
          datasets: [
            {
              label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö',
              data: callData,
              backgroundColor: 'rgba(54, 162, 235, 0.8)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 2
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'white',
                font: {
                  size: 12
                }
              }
            },
            title: {
              display: true,
              text: 'Performance by Agent',
              color: 'white',
              font: {
                size: 16
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: 'white'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            x: {
              ticks: {
                color: 'white'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          }
        }
      });
    }

    // ===== AUTO-REFRESH FUNCTIONS =====
    function startAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
      }
      
      autoRefreshInterval = setInterval(() => {
        refreshDashboard();
        
        // ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤
        if (settings.simulateCalls && Math.random() > 0.7 && agents.some(a => a.status === 'available')) {
          const availableAgents = agents.filter(a => a.status === 'available');
          const randomAgent = availableAgents[Math.floor(Math.random() * availableAgents.length)];
          
          // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤
          window.nativeAPI.notifyAgentEvent(randomAgent.name, 'call_received', {
            callerNumber: '02-' + Math.floor(Math.random() * 1000) + '-' + Math.floor(Math.random() * 10000),
            queue: 'Inbound Queue'
          });
          
          // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
          if (settings.soundEnabled) {
            window.nativeAPI.playNotificationSound('call');
          }
          
          // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô busy
          setTimeout(() => {
            changeAgentStatus(randomAgent.id, 'busy');
          }, 2000);
        }
      }, 30000); // 30 seconds
      
      document.getElementById('autoRefreshBtn').textContent = '‚è∞ ‡∏õ‡∏¥‡∏î Auto-Refresh';
      document.getElementById('autoRefreshBtn').classList.add('button-warning');
    }

    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
      }
      document.getElementById('autoRefreshBtn').textContent = '‚è∞ ‡πÄ‡∏õ‡∏¥‡∏î Auto-Refresh';
      document.getElementById('autoRefreshBtn').classList.remove('button-warning');
    }

    function toggleAutoRefresh() {
      if (autoRefreshInterval) {
        stopAutoRefresh();
      } else {
        startAutoRefresh();
      }
    }

    function refreshDashboard() {
      renderAgents();
      // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô calls ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
      agents.forEach(agent => {
        if (agent.status === 'busy' && Math.random() > 0.5) {
          agent.calls++;
        }
      });
    }

    // ===== FILE OPERATIONS =====
    async function openFile() {
      try {
        console.log('üìÇ [RENDERER] ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå...');
        showResult('fileResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î file dialog...', 'loading');
        
        const result = await window.nativeAPI.openFile();
        
        if (result.success) {
          console.log('‚úÖ [RENDERER] ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result.fileName);
          
          showResult('fileResult', 
            `‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
            `üìÑ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${result.fileName}\n` +
            `üìÅ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${result.filePath}\n` +
            `üìä ‡∏Ç‡∏ô‡∏≤‡∏î: ${result.size} characters`, 
            'success'
          );
          
          // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå
          const contentDiv = document.getElementById('fileContent');
          contentDiv.style.display = 'block';
          contentDiv.innerHTML = `<strong>üìÑ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå ${result.fileName}:</strong>\n\n${result.content}`;
          
          // ‡πÉ‡∏™‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô text editor
          document.getElementById('textEditor').value = result.content;
          
        } else if (result.cancelled) {
          showResult('fileResult', '‚èπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå', 'info');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('fileResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function exportAgentData() {
      try {
        console.log('üìä [RENDERER] ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agent...');
        showResult('fileResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Agent...', 'loading');
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV
        const agentData = [
          'Agent ID,Name,Status,Extension,Department,Total Calls,Last Call,Login Time',
          ...agents.map(agent => 
            `"${agent.id}","${agent.name}","${agent.status}","${agent.extension}","${agent.department}",${agent.calls},"${agent.lastCall || 'N/A'}","${agent.loginTime}"`
          )
        ].join('\n');
        
        const fileName = `agent-report-${new Date().toISOString().split('T')[0]}.csv`;
        
        const result = await window.nativeAPI.saveFile(agentData, fileName);
        
        if (result.success) {
          showResult('fileResult',
            `üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agent ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
            `üìÑ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${result.fileName}\n` +
            `üìÅ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${result.filePath}\n` +
            `üìà ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${agents.length} agents ‡πÉ‡∏ô CSV format`,
            'success'
          );
        } else if (result.cancelled) {
          showResult('fileResult', '‚èπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'info');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('fileResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function exportAgentReport() {
      const csvContent = [
        'Agent ID,Name,Status,Extension,Department,Total Calls,Last Call,Login Time',
        ...agents.map(agent => 
          `"${agent.id}","${agent.name}","${agent.status}","${agent.extension}","${agent.department}",${agent.calls},"${agent.lastCall || 'N/A'}","${agent.loginTime}"`
        )
      ].join('\n');
      
      const fileName = `agent-report-${new Date().toISOString().split('T')[0]}.csv`;
      
      try {
        const result = await window.nativeAPI.saveFile(csvContent, fileName);
        if (result.success) {
          showResult('fileResult', `üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Agent ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüìÑ ${result.fileName}`, 'success');
        }
      } catch (error) {
        console.error('Error exporting report:', error);
      }
    }

    async function saveCurrentContent() {
      const content = document.getElementById('textEditor').value;
      
      if (!content.trim()) {
        showResult('fileResult', '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        return;
      }
      
      try {
        console.log('üíæ [RENDERER] ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤...');
        showResult('fileResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå...', 'loading');
        
        const fileName = `wallboard-document-${Date.now()}.txt`;
        const result = await window.nativeAPI.saveFile(content, fileName);
        
        if (result.success) {
          console.log('‚úÖ [RENDERER] ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result.fileName);
          
          showResult('fileResult',
            `üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
            `üìÑ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${result.fileName}\n` +
            `üìÅ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${result.filePath}\n` +
            `üìä ‡∏Ç‡∏ô‡∏≤‡∏î: ${content.length} characters`,
            'success'
          );
          
        } else if (result.cancelled) {
          showResult('fileResult', '‚èπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'info');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('fileResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function backupSettings() {
      const backupData = {
        agents: agents,
        settings: settings,
        backupTime: new Date().toISOString(),
        version: '1.0.0'
      };
      
      try {
        const result = await window.nativeAPI.saveFile(JSON.stringify(backupData, null, 2), `wallboard-backup-${Date.now()}.json`);
        if (result.success) {
          showResult('fileResult', `üíæ Backup settings ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüìÑ ${result.fileName}`, 'success');
        }
      } catch (error) {
        console.error('Error backing up settings:', error);
      }
    }

    // ===== NOTIFICATION FUNCTIONS =====
    async function testBasicNotification() {
      try {
        console.log('üîî [RENDERER] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö notification...');
        showResult('notificationResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á notification...', 'loading');
        
        const result = await window.nativeAPI.showNotification(
          'Agent Wallboard',
          '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ desktop notification ‡∏ó‡∏î‡∏™‡∏≠‡∏ö! üéâ'
        );
        
        if (result.success) {
          showResult('notificationResult', '‚úÖ ‡πÅ‡∏™‡∏î‡∏á notification ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏î‡∏π notification ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏à‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', 'success');
        } else {
          throw new Error(result.error);
        }

      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function testAgentLogin() {
      try {
        console.log('üü¢ [RENDERER] Agent login notification...');
        showResult('notificationResult', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Agent ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'loading');
        
        const result = await window.nativeAPI.notifyAgentEvent(
          'Alice Johnson',
          'login',
          { time: new Date().toLocaleTimeString('th-TH') }
        );
        
        if (result.success) {
          showResult('notificationResult', 'üü¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Agent Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\nAgent Alice Johnson ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function testCallReceived() {
      try {
        console.log('üìû [RENDERER] Call received notification...');
        showResult('notificationResult', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤...', 'loading');
        
        const result = await window.nativeAPI.notifyAgentEvent(
          'Bob Smith',
          'call_received',
          { 
            callerNumber: '02-123-4567',
            queue: 'Support Queue'
          }
        );
        
        if (result.success) {
          showResult('notificationResult', 'üìû ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\nAgent Bob Smith ‡∏°‡∏µ‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà', 'success');
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function testUrgentAlert() {
      try {
        console.log('üö® [RENDERER] Urgent alert...');
        showResult('notificationResult', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏ß‡∏ô...', 'loading');
        
        const result = await window.nativeAPI.showNotification(
          'üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏ß‡∏ô!',
          '‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô!',
          true // urgent = true
        );
        
        if (result.success) {
          showResult('notificationResult', 'üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ notification ‡πÅ‡∏ö‡∏ö urgent', 'success');
        }
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function testSoundNotification() {
      try {
        showResult('notificationResult', 'üîä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á...', 'loading');
        const result = await window.nativeAPI.playNotificationSound('call');
        
        if (result.success) {
          showResult('notificationResult', 'üîä ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        } else {
          showResult('notificationResult', `‚ö†Ô∏è ${result.error}`, 'error');
        }
      } catch (error) {
        console.error('Error playing sound:', error);
        showResult('notificationResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    function simulateIncomingCall() {
      const availableAgents = agents.filter(a => a.status === 'available');
      if (availableAgents.length > 0) {
        const randomAgent = availableAgents[Math.floor(Math.random() * availableAgents.length)];
        
        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤
        window.nativeAPI.notifyAgentEvent(randomAgent.name, 'call_received', {
          callerNumber: '02-' + Math.floor(Math.random() * 1000) + '-' + Math.floor(Math.random() * 10000),
          queue: 'Simulated Call'
        });
        
        // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        if (settings.soundEnabled) {
          window.nativeAPI.playNotificationSound('call');
        }
        
        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô busy ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setTimeout(() => {
          changeAgentStatus(randomAgent.id, 'busy');
        }, 2000);
        
        showResult('fileResult', `üìû ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡πâ ${randomAgent.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
      } else {
        showResult('fileResult', '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ Agent ‡∏ó‡∏µ‡πà Available ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ', 'error');
      }
    }

    // ===== SYSTEM TRAY FUNCTIONS =====
    function testHideToTray() {
      try {
        console.log('üëÅÔ∏è [RENDERER] ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ tray...');
        showResult('trayResult', 'üëÅÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ system tray...', 'loading');
        
        setTimeout(() => {
          window.nativeAPI.hideToTray();
        }, 1000);
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('trayResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    function testTrayNotification() {
      try {
        console.log('üîî [RENDERER] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö notification ‡∏à‡∏≤‡∏Å tray...');
        showResult('trayResult', 
          '‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö System Tray ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n' +
          'üñ±Ô∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà icon ‡πÉ‡∏ô taskbar/menubar\n' +
          'üìã ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡πà‡∏≤‡∏á‡πÜ\n' +
          'üîÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å tray menu\n' +
          `üë• Available Agents: ${agents.filter(a => a.status === 'available').length}`,
          'success'
        );
        
      } catch (error) {
        console.error('‚ùå [RENDERER] Error:', error);
        showResult('trayResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    function showShortcutsHelp() {
      const helpDiv = document.getElementById('shortcutsHelp');
      helpDiv.style.display = helpDiv.style.display === 'none' ? 'grid' : 'none';
    }

    // ===== SETTINGS FUNCTIONS =====
    function toggleSound(enabled) {
      settings.soundEnabled = enabled;
      document.getElementById('soundEnabled').checked = enabled;
    }

    function toggleAutoRefreshSetting(enabled) {
      settings.autoRefresh = enabled;
      document.getElementById('autoRefresh').checked = enabled;
      
      if (enabled) {
        startAutoRefresh();
      } else {
        stopAutoRefresh();
      }
    }

    function toggleCallSimulation(enabled) {
      settings.simulateCalls = enabled;
      document.getElementById('simulateCalls').checked = enabled;
    }

    async function saveSettings() {
      const settingsToSave = {
        agents: agents,
        settings: settings,
        saveTime: new Date().toISOString()
      };
      
      try {
        const result = await window.nativeAPI.saveSettings(settingsToSave);
        if (result.success) {
          showResult('fileResult', '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }
      } catch (error) {
        console.error('Error saving settings:', error);
        showResult('fileResult', `‚ùå Error ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å settings: ${error.message}`, 'error');
      }
    }

    async function loadSettings() {
      try {
        const result = await window.nativeAPI.loadSettings();
        if (result.success && result.settings) {
          if (result.settings.agents) {
            agents = result.settings.agents;
          }
          if (result.settings.settings) {
            settings = result.settings.settings;
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏ï‡∏≤‡∏° settings
            document.getElementById('soundEnabled').checked = settings.soundEnabled;
            document.getElementById('autoRefresh').checked = settings.autoRefresh;
            document.getElementById('simulateCalls').checked = settings.simulateCalls;
            
            if (settings.autoRefresh) {
              startAutoRefresh();
            } else {
              stopAutoRefresh();
            }
          }
          
          renderAgents();
          showResult('fileResult', '‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }
      } catch (error) {
        console.error('Error loading settings:', error);
        showResult('fileResult', `‚ùå Error ‡πÇ‡∏´‡∏•‡∏î settings: ${error.message}`, 'error');
      }
    }

    function resetSettings() {
      if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) {
        agents = [
          { 
            id: 'AG001', 
            name: 'Alice Johnson', 
            status: 'available', 
            extension: '1001', 
            department: 'Sales', 
            calls: 15, 
            lastCall: '10:30',
            loginTime: '08:00'
          },
          { 
            id: 'AG002', 
            name: 'Bob Smith', 
            status: 'busy', 
            extension: '1002', 
            department: 'Support', 
            calls: 8, 
            lastCall: '10:25',
            loginTime: '08:15'
          },
          { 
            id: 'AG003', 
            name: 'Carol Lee', 
            status: 'break', 
            extension: '1003', 
            department: 'Sales', 
            calls: 12, 
            lastCall: '09:45',
            loginTime: '08:30'
          }
        ];
        
        settings = {
          soundEnabled: true,
          autoRefresh: true,
          simulateCalls: true
        };
        
        document.getElementById('soundEnabled').checked = true;
        document.getElementById('autoRefresh').checked = true;
        document.getElementById('simulateCalls').checked = true;
        
        startAutoRefresh();
        renderAgents();
        showResult('fileResult', '‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      }
    }

    // ===== UTILITY FUNCTIONS =====
    function showResult(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString('th-TH');
      
      element.innerHTML = `[${timestamp}] ${message}`;
      element.className = `result-box ${type}`;
    }

    function updateTrayTooltip(availableCount) {
      if (window.nativeAPI && window.nativeAPI.updateTrayTooltip) {
        window.nativeAPI.updateTrayTooltip(`Available: ${availableCount}/${agents.length} agents`);
      }
    }

    // ===== KEYBOARD SHORTCUTS =====
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case '1':
            e.preventDefault();
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô available ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö agent ‡πÅ‡∏£‡∏Å
            if (agents.length > 0) {
              changeAgentStatus(agents[0].id, 'available');
            }
            break;
          case '2':
            e.preventDefault();
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô busy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö agent ‡πÅ‡∏£‡∏Å
            if (agents.length > 0) {
              changeAgentStatus(agents[0].id, 'busy');
            }
            break;
          case '3':
            e.preventDefault();
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô break ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö agent ‡πÅ‡∏£‡∏Å
            if (agents.length > 0) {
              changeAgentStatus(agents[0].id, 'break');
            }
            break;
          case '4':
            e.preventDefault();
            // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏≠‡∏õ
            window.nativeAPI.showApp();
            break;
          case '5':
            e.preventDefault();
            // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ
            testHideToTray();
            break;
          case 'q':
            e.preventDefault();
            // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) {
              window.nativeAPI.quitApp();
            }
            break;
        }
      }
    });

    // ===== INITIALIZATION =====
    window.addEventListener('DOMContentLoaded', () => {
      console.log('üé® [RENDERER] Agent Wallboard ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß');

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Native APIs
      if (window.nativeAPI) {
        console.log('‚úÖ [RENDERER] Native APIs ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö methods ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
        const requiredMethods = ['openFile', 'saveFile', 'showNotification', 'notifyAgentEvent', 'playNotificationSound'];
        const availableMethods = requiredMethods.filter(method => typeof window.nativeAPI[method] === 'function');
        
        console.log(`üìã Methods ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${availableMethods.length}/${requiredMethods.length}`);
        
        if (availableMethods.length === requiredMethods.length) {
          showResult('fileResult', '‚úÖ Native APIs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!\n\n‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Agent Wallboard...', 'success');
        } else {
          showResult('fileResult', '‚ö†Ô∏è ‡∏ö‡∏≤‡∏á Native APIs ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°\n\n‡πÅ‡∏≠‡∏õ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'loading');
        }
      } else {
        console.error('‚ùå [RENDERER] Native APIs ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°');
        showResult('fileResult', '‚ùå Native APIs ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏õ‡∏ú‡πà‡∏≤‡∏ô Electron', 'error');
        return;
      }

      // ‡πÇ‡∏´‡∏•‡∏î settings
      loadSettings();
      
      // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå initial data
      renderAgents();
      
      // ‡πÄ‡∏£‡∏¥‡πà‡∏° auto-refresh
      if (settings.autoRefresh) {
        startAutoRefresh();
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á welcome notification
      setTimeout(() => {
        window.nativeAPI.showNotification(
          'Agent Wallboard Started',
          `‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!\n‡∏°‡∏µ ${agents.length} Agents ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`
        );
      }, 1000);
    });

    // ‡∏£‡∏±‡∏ö event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å tray
    window.nativeAPI.onStatusChangedFromTray((data) => {
      console.log('üîÑ [RENDERER] ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö status change ‡∏à‡∏≤‡∏Å tray:', data);
      
      showResult('trayResult',
        `üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å System Tray!\n\n` +
        `üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà: ${data.newStatus}\n` +
        `‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(data.timestamp).toLocaleString('th-TH')}\n\n` +
        `‚úÖ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ communication ‡∏à‡∏≤‡∏Å Main ‚Üí Renderer`,
        'success'
      );
    });

    // ‡∏£‡∏±‡∏ö event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î settings tab
    window.nativeAPI.onOpenSettingsTab(() => {
      // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡πÄ‡∏û‡∏∑‡πà‡∏≠ scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà settings section ‡πÑ‡∏î‡πâ
      const settingsSection = document.querySelector('.section:nth-child(6)');
      if (settingsSection) {
        settingsSection.scrollIntoView({ behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>